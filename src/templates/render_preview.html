<!DOCTYPE html>
<html lang="no">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
            crossorigin="anonymous"
        />
        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

        <script type="text/javascript">
            AFRAME.registerComponent('drag-rotate-component', {
                schema: { speed: { default: 1 } },
                init: function () {
                    this.ifMouseDown = false
                    this.x_cord = 0
                    this.y_cord = 0
                    document.addEventListener(
                        'mousedown',
                        this.OnDocumentMouseDown.bind(this)
                    )
                    document.addEventListener(
                        'mouseup',
                        this.OnDocumentMouseUp.bind(this)
                    )
                    document.addEventListener(
                        'mousemove',
                        this.OnDocumentMouseMove.bind(this)
                    )
                },
                OnDocumentMouseDown: function (event) {
                    this.ifMouseDown = true
                    this.x_cord = event.clientX
                    this.y_cord = event.clientY
                },
                OnDocumentMouseUp: function () {
                    this.ifMouseDown = false
                },
                OnDocumentMouseMove: function (event) {
                    if (this.ifMouseDown) {
                        var temp_x = this.x_cord - event.clientX
                        var temp_y = this.y_cord - event.clientY
                        if (Math.abs(temp_y) < Math.abs(temp_x)) {
                            this.el.object3D.rotateY(
                                (temp_x * this.data.speed) / 1000
                            )
                        } else {
                            this.el.object3D.rotateX(
                                (temp_y * this.data.speed) / 1000
                            )
                        }
                        this.x_cord = event.clientX
                        this.y_cord = event.clientY
                    }
                },
            })
        </script>
        <title>E2 - DEM Rendering</title>
    </head>
    <body>
        <a-scene>
            <a-assets>
                <img id="render" src="src/static/render.png" />
                <img id="pano" src="src/static/panorama1.jpg" />
            </a-assets>

            <a-entity light="type: ambient; color: #FFF"></a-entity>

            <a-plane
                position="0 -2.25 0"
                rotation="-90 0 0"
                width="10"
                height="10"
                color="#7BC8A4"
            ></a-plane>

            <a-cylinder
                src="#render"
                side="back"
                material="side: back; repeat: -1 1"
                open-ended="true"
                position="0 0 0"
                height="4.5"
                radius="5"
            ></a-cylinder>

            <a-curvedimage
                src="#pano"
                position="0 0 0"
                radius="5"
                height="3"
                drag-rotate-component
            ></a-curvedimage>
            <a-camera position="0 0 0" look-controls="enabled:false">
                <a-cursor></a-cursor>
            </a-camera>
        </a-scene>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
